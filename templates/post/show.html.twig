{% extends 'base.html.twig' %}

{% block title %}{{ post.title }}{% endblock %}

{% block body %}
    <h1>{{ post.title }}</h1>
    <p><em>By {{ post.user.email }}</em></p>
    <p>{{ post.content }}</p>

    {% if app.user and post.user.id == app.user.id %}
        <p>
            <a href="{{ path('app_post_edit', {id: post.id}) }}">[Edit Post]</a>
            <form action="{{ path('app_post_delete', {id: post.id}) }}" method="post" style="display:inline">
                <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ post.id) }}">
                <button type="submit">[Delete Post]</button>
            </form>
        </p>
    {% endif %}

    <hr>
    <h3>Leave a Comment</h3>

    {% if app.user %}
        <form action="{{ path('comment_new', {id: post.id}) }}" method="post">
            <textarea name="content" required rows="4" cols="50" placeholder="Your comment"></textarea><br>
            <button type="submit">Send</button>
        </form>
    {% else %}
        <p><a href="{{ path('app_login') }}">Sign in</a> to leave comments.</p>
    {% endif %}

    <hr>
    <h3>Comments:</h3>
    <ul>
        {% for comment in post.comments %}
            <li>
                <strong>{{ comment.user.email }}:</strong>
                {{ comment.content }}

                {% if app.user and comment.user.id == app.user.id %}
                    &nbsp;
                    <a href="{{ path('comment_edit', {id: comment.id}) }}">[Edit]</a>
                    <form action="{{ path('comment_delete', {id: comment.id}) }}" method="post" style="display:inline">
                        <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ comment.id) }}">
                        <button type="submit">[Delete]</button>
                    </form>
                {% endif %}
            </li>
        {% else %}
            <li>No comments.</li>
        {% endfor %}
    </ul>
{% endblock %}